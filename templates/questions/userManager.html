<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="/static/LingerUI/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css"/>
    <link href="/static/LingerUI/ligerUI/skins/Gray/css/all.css" rel="stylesheet"/>
    <script src="/static/LingerUI/jquery/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="/static/LingerUI/json2.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/core/base.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerTextBox.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerCheckBox.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerGrid.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerDateEditor.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/plugins/ligerSpinner.js" type="text/javascript"></script>
    <script src="/static/LingerUI/ligerUI/js/ligerui.all.js" type="text/javascript"></script>
    <script src="/static/EmployeeData.js" type="text/javascript"></script>
    <script src="/static/DepartmentData.js" type="text/javascript"></script>
    <script type="text/javascript">

        var DepartmentList = DepartmentData.Rows;
        var sexData = [{Sex: 1, text: '男'}, {Sex: 2, text: '女'}];
        $(f_initGrid);
        var manager, g;

        function f_initGrid() {
            g = manager = $("#maingrid").ligerGrid({
                url: '/user_list',
                width: '100%',
                parms: {csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val()},
                columns: [
                    {display: 'ID',name: 'id', width: 50, type: 'int', frozen: true},
                    {
                        display: '登录名', name: 'u_login_name',
                        editor: {type: 'text'}
                    },
                    {
                        display: '真实名', name: 'u_real_name',
                        editor: {type: 'text'}
                    },
                    {
                        display: '密码', name: 'u_pwd',
                        editor: {type: 'text'}
                    },
                    {
                        display: '创建时间', name: 'u_create_datetime',
                        editor:{type:'datetime'}
                    },
                    {
                        display: '操作', isSort: false, width: 120, render: function (rowdata, rowindex, value) {
                            var h = "";
                            if (!rowdata._editing) {
                                h += "<a href='javascript:beginEdit(" + rowindex + ")'>修改</a> ";
                                h += "<a href='javascript:deleteRow(" + rowindex + ")'>删除</a> ";
                            }
                            else {
                                h += "<a href='javascript:endEdit(" + rowindex + ")'>提交</a> ";
                                h += "<a href='javascript:cancelEdit(" + rowindex + ")'>取消</a> ";
                            }
                            return h;
                        }
                    }
                ],
                onSelectRow: function (rowdata, rowindex) {
                    $("#txtrowindex").val(rowindex);
                },
                enabledEdit: true, clickToEdit: false, isScroll: false,
                //data: EmployeeData,

            });
        }

        function beginEdit(rowid) {
            manager.beginEdit(rowid);
        }

        function cancelEdit(rowid) {
            manager.cancelEdit(rowid);
        }

        function endEdit(rowid) {
            var row = manager.getSelectedRow();
            manager.endEdit(rowid);
            //添加视图: user_update   需要取得整行的数据 
            $.post("/user_update",{
                js:JSON.stringify(row),
                csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val()
            },function () {
                
            })
        }

        function deleteRow(rowid) {
            var row = manager.getSelectedRow();
            if (confirm('确定删除?')) {
                manager.deleteRow(rowid);
                //添加视图：user_del
                $.post("/user_del",
                    {
                        js:JSON.stringify(row),
                        csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val()
                    },function () {
                    
                })
            }
        }

        var newrowid = 100;

        function addNewRow() {
            manager.addEditRow();
        }

        function getSelected() {
            var row = manager.getSelectedRow();
            if (!row) {
                alert('请选择行');
                return;
            }
            alert(JSON.stringify(row));
        }

        function getData() {
            var data = manager.getData();
            alert(JSON.stringify(data));
        }
    </script>
</head>
<body style="padding:10px">
{% csrf_token %}
用户名: <input id="u_login_name"/>&nbsp;&nbsp;&nbsp;&nbsp;
真实名: <input id="u_real_name"/>&nbsp;&nbsp;&nbsp;&nbsp;
密 &nbsp;&nbsp;&nbsp;码：<input type="password" id="u_pwd"/>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" value="保存" id="btnSave" style="width: 50px"/>&nbsp;&nbsp;
<input type="button" value="清空" id="btnClear" style="width: 50px"/>
<script type="text/javascript">
    $(function () {
        $('#btnSave').click(function () {
            $.post(
                '/user_save',
                {
                    csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val(),
                    u_login_name: $('#u_login_name').val(),
                    u_real_name: $('#u_real_name').val(),
                    u_pwd: $('#u_pwd').val()
                },
                function (ret) {
                    if (ret == 'ok') {
                        alert("保存成功:" + ret.u_login_name)
                        $('#u_login_name').val('');
                        $('#u_real_name').val('');
                        $('#u_pwd').val('');
                        f_initGrid();
                    }
                    else {
                        alert(ret)
                    }
                }
            )
        });
        $('#btnClear').click(function () {
            $('#u_login_name').val('');
            $('#u_real_name').val('');
            $('#u_pwd').val('');
        });
    })
</script>
{% csrf_token %}
<div class="l-clear"></div>
<div id="maingrid" style="margin-top:20px"></div>
<!--<br/>
<br />
<a class="l-button" style="width:120px" onclick="getSelected()">获取选中的值(选择行)</a>
<br />
<a class="l-button" style="width:120px" onclick="getData()">获取当前的值</a>
<div style="display:none;">
</div>-->
</body>
</html>
